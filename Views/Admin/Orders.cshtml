@model IEnumerable<MasterServicePlatform.Web.Models.Order>

@{
    Layout = "_AdminLayout";

    string fUser = ViewBag.User ?? "";
    string fMaster = ViewBag.Master ?? "";
    string fStatus = ViewBag.Status ?? "";
    string fSort = ViewBag.Sort ?? "";
}

<h2 class="mt-4 mb-3 fw-bold">Orders</h2>

<form method="get" class="row g-3 mb-4">

    <div class="col-md-3">
        <input type="text" name="user" class="form-control"
               placeholder="Search user..." value="@fUser" />
    </div>

    <div class="col-md-3">
        <input type="text" name="master" class="form-control"
               placeholder="Search master..." value="@fMaster" />
    </div>

    <div class="col-md-2">
        <select name="status" class="form-select">
            <option value="">All statuses</option>
            <option value="Pending" selected="@(fStatus == "Pending")">Pending</option>
            <option value="Accepted" selected="@(fStatus == "Accepted")">Accepted</option>
            <option value="Completed" selected="@(fStatus == "Completed")">Completed</option>
        </select>
    </div>

    <div class="col-md-2">
        <select name="sort" class="form-select">
            <option value="">Default</option>
            <option value="date" selected="@(fSort == "date")">By date</option>
            <option value="status" selected="@(fSort == "status")">By status</option>
        </select>
    </div>

    <div class="col-md-2 d-flex gap-2">
        <button class="btn btn-primary w-100">Filter</button>
        <a href="/Admin/Orders" class="btn btn-outline-secondary w-100">Reset</a>
    </div>

</form>

<div class="table-responsive">
    <table class="table table-hover align-middle shadow-sm rounded bg-white" style="min-width: 900px;">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>User</th>
                <th>Master</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var o in Model)
            {
                <tr class="click-row" style="cursor:pointer;" data-href="/Admin/OrderDetails/@o.Id">

                    <td>@o.Id</td>

                    <td>@o.User.FirstName @o.User.LastName</td>

                    <td>
                        @(o.Master != null
                                            ? $"{o.Master.FirstName} {o.Master.LastName}"
                                            : "—")
                </td>

                    <td>
                        <span class="status-badge status-@o.Status.ToString().ToLower()">
                            @o.Status
                        </span>
                    </td>



                    <td>@o.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                </tr>
                        }
        </tbody>
    </table>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".click-row").forEach(row => {
            row.addEventListener("click", e => {
                if (e.target.closest("a") || e.target.closest("button"))
                    return;
                window.location = row.dataset.href;
            });
        });
    });
</script>
